@model SchoolHub.Models.TeacherHomeModel

@{
    ViewBag.Title = "Teacher Home Page";
}

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Teacher Home</title>

    <!--Required for all of this code -->
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>

    <!--Needed for Column ReOrder functionality-->
    <script src="https://cdn.datatables.net/colreorder/1.5.1/js/dataTables.colReorder.min.js"></script>

    <!-- Needed for Responsive dataTable -->
    <script src="https://cdn.datatables.net/responsive/2.2.1/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.1/js/responsive.bootstrap4.min.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>

    <!-- CSS needed for datatables-->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.1/css/responsive.bootstrap4.min.css">

    <script src="~/Scripts/SchoolHubScripts/Cookie.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-expand-sm navbar-dark bg-dark">
        <a class="navbar-brand mr-auto" href="~/Views/TeacherHome/TeacherHomeIndex.cshtml">Home</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#">Calendar</a>
                </li>
                <li class="nav-item">
                    @Html.ActionLink("TeacherHome", "AddClass", new { userId = Model.User.Id})
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">View Student List</a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item ">
                    <a class="nav-link" href="ChangePassword">Change Password</a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="../Login/LoginIndex">Sign Out</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="jumbotron">
        <script>
            var UserId = getCookie("userId");
            console.log(UserId)
        </script>
        <table id="example" class="table table-striped table-bordered" style="width:100%">
            <!-- Goes at the top of the page. This should always be consitant with the footer -->
            <thead>
                <tr>
                    <th>Class Identifier</th>
                    <th>Class Name</th>
                    <th>Class Description</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Teacher Name</th>
                    <th>School Name</th>
                    <th>Add Class Event</th>
                </tr>
            </thead>

            <!-- Content will be dynamically entered in here -->
            <tbody>
                @for (int i = 0; i < Model.Classes.Count; i++)
                {
                <tr>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].Number)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].Name)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].Description)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].StartDate)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].EndDate)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].TeacherName)</td>
                    <td>@Html.DisplayFor(Model => Model.Classes[i].SchoolName)</td>
                    <td>
                        @*<form action="EventHome">*@
                            <input type="hidden" id="key" value=@Html.DisplayFor(Model => Model.Classes[i].Id) />
                            <button type="submit" class="btn btn-secondary btn-sm" id="submit" name="submit" >Add Event</button>
                            
                        @*</form>*@
                    </td>
                </tr>
                }
            </tbody>
        </table>

        <script src="~/Scripts/SchoolHubScripts/DatatableModal.js"></script>

        <script>
            $(document).ready(function () {
                $("#submit").click(function (e) {
                    if ($("#key").val() == "")
                        alert("Failed to retrieve class events");
                    else {
                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            data: { "key": + $("#key").val() },
                            dataType: "html",
                            success: function (result, status, xhr) {
                                out = JSON.parse(result)
                                if (out.message != "") {
                                    alert(out.message)
                                } else {
                                    var url = '@Url.Action("EventHome", "TeacherHome")?inClassId=' + $("#key").val();
                                    window.location.href = url;
                                }
                            },
                            error: function (xhr, status, error) {
                                alert("Issue occured while retrieving events" + error)
                            }
                        });
                    }
                    return false;
                });
            });
            
        </script>

    </div>
    <!-- End jumbotron -->
</body>

</html>

